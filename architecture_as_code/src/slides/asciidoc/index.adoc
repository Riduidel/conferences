:icons: font
:revealjs_progress: true
:revealjs_previewLinks: true
:revealjs_mouseWheel: true
:revealjs_history: true
:revealjs_preloadIframes: true
:revealjs_plugin_notes: disabled
:customcss: custom.css
:source-highlighter: highlightjs

[%notitle]
= Architecture as code
:sectnums!:

[NOTE.speaker]
--
--

== Sponsors



[%notitle]
== Qui suis-je ?

Nicolas Delsaux / @riduidel on https://twitter.com/riduidel[icon:twitter[]] / https://github.com/riduidel[icon:github[]] / https://stackexchange.com/users/8620[icon:stack-overflow[]]

D√©veloppeur Java depuis l'an 2000

Architecte de solutions/syst√®mes depuis 2015

image::images/zenika.png[height=100]

[NOTE.speaker]
--
--


== Pourquoi documenter l'architecture ?

++++
<div align=center>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Because the code is the truth, but not the whole truth.</p>&mdash; Grady Booch (@Grady_Booch) <a href="https://twitter.com/Grady_Booch/status/1253062981283221504?ref_src=twsrc%5Etfw">April 22, 2020</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 
</div>
++++

[NOTE.speaker]
--
On pourrait parler de politique dans les entreprises,
de syst√®mes socio-techniques, etc...
Mais en fait, c'est tellement plus simple de dire que si le code explique correctement le "comment" d'un logiciel,
il ne r√©pond pas √† quelques autres questions
--

=== A quelles questions r√©pondre ?

* Qui ?
* Quand ?
* Quoi ?
* [line-through]#O√π ?#
* Pourquoi ?
* [line-through]#Comment ?#

[NOTE.speaker]
--
Les lignes barr√©es correspondent aux questions pour lesquelles la r√©ponse est √©vidente.
Les autres ont des r√©ponses un peu moins √©videntes.

J'ignorais que https://fr.wikipedia.org/wiki/QQOQCCP[ces questions] provenaient de la m√©thode aristoc√©licienne.
En revanche, je connais l'acronyme des 5W et son usage dans le journalisme.
Et je trouve int√©ressant de se poser la m√™me question √† propos d'un syst√®me logiciel, pr√©cis√©ment parce qu'il s'agit d'un artefact ayant une vie impliquant des personnes aux profils divers.
--

== Mais comment documenter l'architecture ?

Voyons √ßa √† travers un exemple

[NOTE.speaker]
--
C'est un atelier, donc c'est participatif.
En l'occurence, vous allez d√©finir et documenter l'architecture d'un syst√®me pour lequel je vais jouer le r√¥le du client.
Quel syst√®me ?
--


=== SUP La Seine image:images/stand-up-paddle_emoji.png[width=100px]

=== A vous de jouer üìù

R√®gle du jeu

* 30‚Äô Chaque √©quipe cr√©e un (ou plusieurs) diagrammes d√©crivant le **syst√®me** SUP La Seine image:images/stand-up-paddle_emoji.png[width=40px]
** Le facilitateur est l√† pour vous aider, n‚Äôh√©sitez pas √† le solliciter

* Chaque √©quipe fournit les diff√©rents √©l√©ments √† l'√©quipe √† sa gauche
* 5‚Äô chaque √©quipe √©tudie les diagrammes fournis (vous pouvez mettre des post-its contenant vos questions/interrogations/surprises)

* 5‚Äô Dans chaque √©quipe, un membre vient montrer comment les use cases sont impl√©ment√©s

[NOTE.speaker]
--
Pourquoi faire pr√©senter par une autre √©quipe ?
Parce que c'est dr√¥le ?
Non. Parce que quand on demande aux gens de noter des diagrammes d'architecture, ils mettent une note de 7/10 √† √† peu pr√®s tout ce qu'ils voient. 
Ca n'est donc pas un bon indicateur.
Demander aux gens de restituer un diagramme qu'ils n'ont pas √©crit me para√Æt un meilleur moyen de savoir ce qu'ils en ont compris
--

[background-iframe="https://www.chronometre.fr/minuteur-30-minutes.html"]
[%notitle]
=== A vous de jouer üìù 1 - r√©flexion

[background-iframe="https://www.chronometre.fr/minuteur-05-minutes.html"]
[%notitle]
=== A vous de jouer üìù 2 - relecture

=== Show time üé≠

=== Comment √ßa s'est pass√© ?

Est-ce que vos diagrammes √©taient

[%step]
* l√©gend√©s ? (on sait ce qu‚Äôest chaque patate ü•î dans le diagramme)
* consistants ? (repr√©sentant les m√™mes niveaux de d√©tails pour les diff√©rents √©l√©ments visibles)
* coh√©rents ? (est-ce que tous les √©l√©ments pr√©sent√©s avaient du sens)

=== Passons √† une √©valuation "rigoureuse"

image::images/c4model-bingo.png[width=900]

[NOTE.speaker]
--
Ce bingo a √©t√© cr√©√© par Simon Brown √† la suite de ses nombreuses animations d'ateliers C4.
Que pensez-vous de vos diagrammes √† la lumi√®re de cette √©valuation ?
--

== Comment faire mieux ?

[.columns]
=== Avec C4!

[.column]
image::images/simon_brown.png[width=500]

[.column]
* Context, Containers, Components and Code
* Imagin√© par Simon Brown https://twitter.com/simonbrown[icon:twitter[] @simonbrown]
* La m√©taphore habituelle de la carte

[transition=none]
=== C4

[cols="4*", frame=none, grid=none]
|====
.>| image:images/openstreetmap-carte-france.png[]
.>| image:images/openstreetmap-carte-ile-de-france.png[]
.>| image:images/openstreetmap-carte-paris.png[]
.>| image:images/openstreetmap-carte-porte-maillot.png[]
.<| image:images/c4_SystemContext.png[]
.<| image:images/c4_Containers.png[]
.<| image:images/c4_Components.png[]
.<| image:images/c4_class-diagram.png[]
|====

[transition=none]
=== C4 - Context

[cols="25%, 75%", frame=none, grid=none]
|====
.>| image:images/openstreetmap-carte-france.png[]
.2+a|Pr√©sente l‚Äôapplication dans son contexte

* Liste des utilisateurs
** √ßa n‚Äôest pas un hasard si √ßa ressemble aux user stories
* Liste des syst√®mes interconnect√©s
** M√™me √† travers gravitee
** M√™me √† travers Kafka
** Indiquer le type d‚Äôinterconnexion

.<| image:images/c4_SystemContext.png[]

|====

[transition=none]
=== C4 - Containers

[cols="25%, 25%, 50%", frame=none, grid=none]
|====
.2+|
.>| image:images/openstreetmap-carte-ile-de-france.png[]
.2+a| Les conteneurs sont les √©l√©ments signifiants de l‚Äôarchitecture

* Ce ne sont pas forc√©ment les conteneurs Docker de l‚Äôapplication
* Ce ne sont pas forc√©ment les modules Maven/Gradle de l‚Äôapplication
* Ce ne sont pas forc√©ment les WAR/EJB-JAR

.<| image:images/c4_SystemContext.png[]

|====

[transition=none]
=== C4 - Components

[cols="50%, 25%, 25%", frame=none, grid=none]
|====
.2+a|Si votre framework utilise des composants, c‚Äôest cool

* Spring
* Java EE
* GWT
* Swing
* VueJS
* React
* Symphony

.>| image:images/openstreetmap-carte-paris.png[]
.2+|
.<| image:images/c4_Components.png[]

|====


[transition=none]
=== C4 - Code

[cols="75%, 25%", frame=none, grid=none]
|====
.2+a|Est-ce qu‚Äôon documente son code avec un outil de documentation d‚Äôarchitecture ? Pas forc√©ment

En revanche, on est capable de d√©finir le contexte de ce code

.>| image:images/openstreetmap-carte-porte-maillot.png[]
.<| image:images/c4_class-diagram.png[]
|====

=== A vous de jouer üìù

R√®gle du jeu

* 30‚Äô Chaque √©quipe cr√©e les diagrammes C4 d√©crivant le **syst√®me** SUP La Seine image:images/stand-up-paddle_emoji.png[width=40px]
** Le facilitateur est l√† pour vous aider, n‚Äôh√©sitez pas √† le solliciter

* Chaque √©quipe fournit les diff√©rents √©l√©ments √† l'√©quipe √† sa gauche
* 5‚Äô chaque √©quipe √©tudie les diagrammes fourni (vous pouvez mettre des post-its contenant vos questions/interrogations/surprises)

* 5‚Äô Dans chaque √©quipe, un membre vient pr√©senter comment les use cases sont impl√©ment√©s

[background-iframe="https://www.chronometre.fr/minuteur-30-minutes.html"]
[%notitle]
=== A vous de jouer üìù 1 - r√©flexion

[background-iframe="https://www.chronometre.fr/minuteur-05-minutes.html"]
[%notitle]
=== A vous de jouer üìù 2 - relecture

=== Show time üé≠

=== Comment √ßa s'est pass√© ?

Est-ce que vos diagrammes √©taient

[%step]
* l√©gend√©s ? (on sait ce qu‚Äôest chaque patate ü•î dans le diagramme)
* consistants ? (repr√©sentant les m√™mes niveaux de d√©tails pour les diff√©rents √©l√©ments visibles)
* coh√©rents ? (est-ce que tous les √©l√©ments pr√©sent√©s avaient du sens)

== Comment faire mieux ?

[.columns]
=== Structurizr

[.column]
* On construit un mod√®le (et pas une simple ‚Äúimage‚Äù)
* Simple √† √©crire
** Via le DSL sp√©cifique
* Li√© au code
** Gr√¢ce √† des biblioth√®ques de d√©tection

[.column]
image::images/structurizr_dsl.png[]

=== A nous de jouer üìù

=== Mais sur quel wifi ?

image::images/wifi_snowcamp.png[width="1200"]

=== D√©marrer Structurizr

Sous Windows

----
docker run -it --rm -p 8080:8080 -v %CD%:/usr/local/structurizr structurizr/lite:3045
----

Sous Linux/MacOS

----
docker run -it --rm -p 8080:8080 -v $PWD:/usr/local/structurizr structurizr/lite:3045
----

Astuce

----
echo "structurizr.autoRefreshInterval=2000" > structurizr.properties
----

[background-iframe="https://github.com/structurizr/dsl/blob/master/docs/language-reference.md"]
[%notitle]
=== Cr√©er un mod√®le

=== A nous de jouer üìù

== Conclusion

[%notitle]
=== C'est cool d'avoir un mod√®le

image::https://storage.googleapis.com/assets.icepanel.io/blog/modelling-vs-diagramming-software-architecture/infographic.png[height=740]

[NOTE.speaker]
--
Voir aussi l'article https://blog.icepanel.io/2022/09/21/modelling-vs-diagramming-software-architecture/
--

=== Qu'est-ce qu'on a gagn√© ?

* Un mod√®le de l‚Äôarchitecture de notre application *synchronis√©* avec notre code
* La capacit√© de produire les diagrammes standard √† partir du code
* La capacit√© de d√©crire aussi les diagrammes de d√©ploiement pour les diff√©rents d√©ploiements de l‚Äôapplication
* La capacit√© d'interroger facilement ce mod√®le d‚Äôarchitecture
** Produire la cartographie des flux
** Produire un inventaire des machines

=== Voir aussi

++++
<iframe width="1280" height="800" src="https://www.youtube.com/embed/UzFpFQgeEyc" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
++++

=== Quelques ressources

* https://structurizr.com[Structurizr]
* https://arc42.org/[Arc42]

* https://riduidel.github.io/aadarchi/[Aadarchi] (auto-promo)
* https://vistecture.me/[Vistecture]
* https://icepanel.io/[Icepanel]
* https://carbide.dev/[Carbide]

== Merci !

image::https://media.giphy.com/media/1sMH6m5alWauk/giphy.gif[width=200%]
